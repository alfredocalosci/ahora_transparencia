<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>concejal</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <!-- Google Font -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:700' rel='stylesheet' type='text/css'>
    

    <!-- Table Sorter -->
    <link rel="stylesheet" href="js/themes/blue/style.css" type="text/css" id="" media="print, projection, screen" />
<link href="css/tablas.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>


<body>

    <div class="container">
    <div class="row" id="intro">
    
    <div class="col-md-7 nopaddingL">
  
    <p> ahora madrid >>  <a href="index.html"> transparencia </a>>> <a href="salarios.html"> salarios </a> >> concejales</p>
        <hr/>
    <p class="bigger">En nuestra voluntad de trasparencia os mostramos el Presupuesto de Ahora 
    Madrid y los ingresos que llevamos hasta el momento.
    </p>
    
    <p>Nuestra intención es publicar al detalle de cada gasto pasada la campaña y una vez contrastadas las facturas que estamos recibiendo. Igual con los 
    ingresos, ya que debemos verificar los datos de las donaciones y 
    micro-créditos.</p>
    
        </div>
    
    <div class="col-md-5 text-right nopaddingR">
    <p>&nbsp;</p>
    <hr/>
    <select>
      <option value="volvo">Gastos Campaña Elecciones Municipales 2015</option>
      <option value="saab">Ingresos Campaña Elecciones Municipales 2015</option>
      <option value="mercedes">Gastos Ejercicio 2015</option>
      <option value="audi">Ingresos Ejercicio 2015</option>
    </select>
    
    <hr/>
    
    <p><em>última actualización: 20 de mayo, 2015</em></p>
    <p><a href="datos_03/gastos.csv"><i class="fa fa-download" style="padding-right: 1em;"></i> <small>descargar .csv</small></a></p>
    </div>
    </div>
    
    <div class="row">
    <div class="col-md-9 nopaddingL">
    <hr/>
    <h2><span id="miNombre"></span> <span id="miApellido"></span></h2>
    <p id="miCargo"> </p>
    <p id="miDescripcion">
    </p>
    </div>
    
     <div class="col-md-3 nopaddingR">
     <hr/>
     <img id="miFoto" src="img/people/user.png" alt="" />
     </div>
    </div>
    
    
     
    
    <div class="row">
    <div class="col-md-12 noPadding">
        Los salarios de los concejales de Ahora Madrid están limitados. La diferencia entre el salario "oficial" establecido por el pleno y el salario que cobran se destina por un lado a financiar proyectos de innovación social en la plataforma de Goteo de crowdfounding y otro porcentaje para financiar partidos y asociaciones que cada concejal elige.
    
    <!--<table id="salarios_meses" class="table tablesorter"> 
    <thead> 
    
    <tr> 
        <th>mes</th> 
        <th>salario nominal</th> 
        <th>salario percibido</th> 
        <th>goteo</th>
        <th>donación</th>
        <th>a favor de</th>
        <th>donación</th>
        <th>a favor de</th>
     </tr> 
     
    </thead> 
    <tbody></tbody> 
    </table>  -->
    
    </div>
    </div>
    
     <div class="row">
     
     <div class="col-md-12 noPadding" id="totalG">
     	<div class="bg_tot bloque">
     	<p class="concepto">salario bruto anual</p>
    	<p class="importe money">total</p>
     	</div>
     </div>
     
     </div>
     
      <div class="row">
     
         <div class="col-md-12 noPadding">
             <div id="partes">
                 <div class="bg_t1 bloque">
                     <p class="concepto">Salario limitado neto anual</p>
                     <p class="importe money"> <span> </span></p>
                 </div>
                
                 <div class="bg_t3 bloque">
                     <p class="concepto">Goteo</p>
                     <p class="importe ">20% del resto <span> </span></p>
                 </div>
                 <div class="bg_t4 bloque">
                     <p class="concepto">Donaciones</p>
                     <p class="importe ">80% del resto <span> </span></p>
                 </div>
             </div>
         </div>
          
     </div>
     <div class="row">
        <h3> Destinatarios de las donaciones </h3>
        <ul class="nav nav-tabs">
          <li role="presentation" class="active">
            <a href="#periodo-0"> 15 Junio 2015 - 30 Dic 2015</a>
          </li>          
        </ul>
        <div id="my-tab-content" class="tab-content">
            <div class="tab-pane active" id="periodo-0">
               <table id="donaciones_periodo" class="table tablesorter"> 
                    <thead> 
                    
                        <tr> 
                            <th>Destinatario</th> 
                            <th>Cantidad</th> 
                         </tr> 
                     
                    </thead> 
                    <tbody></tbody> 
                </table>  
            </div>
        </div>

     </div>
    
    
    <div class="row">
    <div class="col-md-12 noPadding">
    <hr/>
    <h4>otros concejales</h4>
    </div>
    
     <div class="col-md-12 noPadding" id="concejales"></div>
    </div>
    
    <footer>
    <div class="row">
    <div class="col-md-12 noPadding">
    footer
    </div>
    </div>
    
    </footer>
    
    
    </div> <!-- end container -->
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
     <script src="js/jquery.min.js"></script>
     <!-- Include all compiled plugins (below), or include individual files as needed -->
     <script src="js/bootstrap.min.js"></script>
     
     <!-- CSV parse -->
     <script src="js/papaparse.min.js"></script>
     <!-- formatCurrency -->
     <script src="js/jquery.formatCurrency-1.4.0.pack.js"></script>
      <!-- formatDate -->
      <script src="js/moment-with-locales.js"></script>
     
     <!-- tablesorter -->
     <script type="text/javascript" src="js/jquery.tablesorter.min.js"></script> 
     
     <!-- highcharts.js 
     <script src="http://code.highcharts.com/highcharts.js"></script>
     <script type="text/javascript" src="http://code.highcharts.com/modules/data.js"></script>
     -->
     
     <!-- isotope -->
     <script src="js/isotope.pkgd.js"></script>
     <script src="js/packery-mode.pkgd.min.js"></script>
     
     <!-- cookies -->
     <script src="js/js.cookie.js"></script>
     <script src="js/salarios_common.js"></script>

     
     <script>    
     var totC = {nominal:0.0, percibido:0.0, goteo:0.0, donacion:0.0}; 
     var c 
     
     $(document).ready(function() { 
     
     
             c = Cookies.get('concejal')
             thisID = "c02";             
             if(c === "undefined"){
                // nothing
             } else {
                 thisID = c;
             }    
                      
             
             moment.locale('es');  // translate dates to es format
             
             
            /**[0]  nombre [1] :cargo [2] descrip
            //[3]:salario bruto anual 
            [4] bruto mensual 14 pagas 
            [5] salario bruto menual 12 pagas 
            [6] salario neto anual 
            [7] salario neto mensual 14 pagas 
            [8] neto anual 12 pagas
            **/
             
             /*** datos del concejal **/
             $.getJSON( "datos_03/concejal.json", function( data ) {
                infoConcejales=data.concejales
                data.concejales[thisID]
                $("#miCargo").text(data.concejales[thisID][1])
                $("#miDescripcion").text(data.concejales[thisID][2])
                $(".bg_t1 .importe span").text(data.concejales[thisID][6]) //neto anual

                  /*var items = [];
                  $.each( data.concejales, function( key, val ) {
                    console.log(val)
                  });*/                 
                 parseCsv();
            });    

          
     }); 


function parseCsv(){
 Papa.parse("datos_03/salarios.csv", {
    download: true,
    header: true,
    delimiter: "\t",    
    complete: function(results) {
         //console.log(results.data);
        
        /*
        var meses = []; // todos MM_AAAA
        var mesesR = []; // rótulos MM, AAAA
        var mesesL = []; // labels
        */
        
        var peopleID = []; // just ID // once
        var peopleIDRow = []; // just ID
        var peopleData = []; // data Objects // once
        var peopleDataRow = []; // data Objects
        var myTable =  $("#donaciones_periodo > tbody");

        $.each( results.data, function( index, value ) {
            datos=results.data
             var obj = value;
             
             // metemos los datos del concejal si es el de la pagina donde estamos
             if(obj.id === thisID){                         
                 var miMes = moment(obj.fecha, "DD/MM/YYYY").format("MMMM");
                 var miAnno = moment(obj.fecha, "DD/MM/YYYY").format("YYYY");
                 // var mes_anno = miMes +"_" + miAnno;
                 var mesYanno = miMes +", " + miAnno;
                 
                 //Aqui es donde se mete la donacion TBD TODO
                 /*
                 var myRow = "<tr>";
                 myRow += "<td>" + mesYanno + "</td>" ; // mes, año
                 myRow += "<td class='money'>" + obj.s_nominal + "</td>" ;
                 myRow += "<td class='money'>" + obj.s_percibido + "</td>" ;
                 myRow += "<td class='money'>" + obj.goteo + "</td>" ;
                 myRow += "<td class='money'>" + obj.donacion_1 + "</td>" ;
                 myRow += "<td>" + obj.favor_1 + "</td>" ; 
                 myRow += "<td class='money'>" + obj.donacion_2 + "</td>" ;
                 myRow += "<td>" + obj.favor_2 + "</td>" ; 
                    
                 $(myTable).append( myRow);
                 */

                var myRow = "<tr>";
                  myRow += "<td>Goteo</td>" ; 
                 myRow += "<td class='money'>" + obj.goteo + "</td>" ;
                 myRow+="</tr>"

                 /*myRow += "<tr><td class='money'>" + obj.donacion_1 + "</td>" ;
                 myRow += "<td>" + obj.favor_1 + "</td></tr>" ; 
                 myRow += "<tr><td class='money'>" + obj.donacion_2 + "</td>" ;
                 myRow += "<td>" + obj.favor_2 + "</td></tr>" ; */
                 for (var i=0 ; i<10; i++){
                    if(obj["donacion_"+i] === undefined  || obj["favor_"+i]=== undefined) continue;
                    else {
                        myRow += "<tr> <td>" + obj["favor_"+i] + "</td>" ; 
                        myRow += "<td class='money'>" + obj["donacion_"+i] + "</td> </tr>" ;
                    }
                 }
                    
                 $(myTable).append( myRow);

                 totC['nominal'] += parseFloat(obj.s_nominal);
                 totC['percibido'] += parseFloat(obj.s_percibido);
                 totC['goteo'] += parseFloat(obj.goteo);
                 totC['donacion'] += parseFloat(obj.donacion_1);
                 totC['donacion'] += parseFloat(obj.donacion_2);
                
             }                           

             peopleIDRow.push(obj.id); 
             peopleDataRow[obj.id] = {nombre: obj.nombre, apellidos: obj.apellidos, status: obj.status, nominal: 0.0, percibido: 0.0, goteo: 0.0, donaciones: 0.0};
        }); 
        
        $.each(peopleIDRow, function(i, el){
            if($.inArray(el, peopleID) === -1){
             peopleID.push(el);
            }
        });
        
        for (i = 0; i < peopleID.length; i++) { 
            var ID = peopleID[i];
            var P = peopleDataRow[ID];
            peopleData[ID] = P;
        }
                
        var peopleIDRow = []; // clean up
        var peopleDataRow = [];
        
       
        
    $.each( results.data, function( index, value ) {
         var obj = value;
          
         
         
         // tot by people // all people
         peopleData[obj.id].nominal += parseFloat(obj.s_nominal);
         peopleData[obj.id].percibido += parseFloat(obj.s_percibido);
         peopleData[obj.id].goteo += parseFloat(obj.goteo);
         peopleData[obj.id].donaciones += parseFloat(obj.donacion_1);
         peopleData[obj.id].donaciones += parseFloat(obj.donacion_2);
         
         
    }); 
    

    
    
    // write total(s)
    $("#totalG .bg_tot p.importe").text(totC['nominal']);
    //$("#partes .bg_t1 p.importe").text(totC['percibido']);
    // $("#partes .bg_t2 p.importe").text(totC['e']);
    //$("#partes .bg_t3 p.importe").text(totC['goteo']);
    //$("#partes .bg_t4 p.importe").text(totC['donacion']);
    
    // calculate width NO LO USO BORRAR
    var t1W = totC['percibido'] * 100.00 / totC['nominal'];
    var t2W = totC['e'] * 100.00 / totC['nominal']; 
    var t3W = totC['goteo'] * 100.00 / totC['nominal'];
    var t4W = totC['donacion'] * 100.00 / totC['nominal'];
    var t0W = totC['percibido'] * 100.00 / totC['nominal']; 
    
    // update % texts
    /*
    $('#d1').text(t0W.toFixed(1) + '%');
    $('#d2').text(t3W.toFixed(1) + '%');
    $('#d3').text(t4W.toFixed(1) + '%');
    */
    
    // assign width
    $('#partes .bg_t1').css({width: "60" + '%'});
    $('#partes .bg_t2').css({width: "30"+ '%'}); //no se usa
    $('#partes .bg_t3').css({width: "10" + '%'}); // goteo
    $('#partes .bg_t4').css({width: "30" + '%'}); // goteo
        
    // cards concejales / table eventuales
    // var myTable =  $("#salarios_eventuales > tbody");
    
    var  miObj = peopleData[thisID];
    $("#miNombre").text(miObj.nombre);
    $("#miApellido").text(miObj.apellidos);
    $("#miFoto").attr("src","img/people/"+thisID+".jpg");
    console.log(thisID)
     generateCards(peopleID, peopleData, infoConcejales);       
    
     window.setTimeout(initC, 500);
    }
 });
}

     function initC() {
     /*$("#salarios_meses").tablesorter({ 
             // sort on the first column and third column, order asc 
              sortList: [[0,0]] 
         }); */
         
     $('.money').formatCurrency({
        decimalSymbol: ',',
        digitGroupSymbol: '.',
        symbol: '€',
        positiveFormat: '%n <span class="euro">%s</span>',
      });

      
      
      
      // isotope
      var $grid = $('#concejales').isotope({
        // options
        itemSelector: '.card',
        // layoutMode: 'fitRows',
        layoutMode: 'packery',
        packery: {
          gutter: 8
        }         
      });
      
      
      $( ".card" ).click(function() {
        var c = $(this ).data( "id" ); // 52
        Cookies.set('concejal', c, { expires: 7, path: '' });
        window.location.href = "concejal.html";
        // alert( "Handler for " + c);
      });     
     }

               
    </script>
</body>

</html>