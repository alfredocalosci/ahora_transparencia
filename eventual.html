<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>salarios</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <!-- Google Font -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Ubuntu:700' rel='stylesheet' type='text/css'>
    

    <!-- Table Sorter -->
    <link rel="stylesheet" href="js/themes/blue/style.css" type="text/css" id="" media="print, projection, screen" />
<link href="css/tablas.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>


<body>

    <div class="container">
    <div class="row" id="intro">
    
    <div class="col-md-7 nopaddingL">
      <p>ahora madrid: transparencia</p>
          <hr/>
      <p class="bigger">En nuestra voluntad de trasparencia os mostramos el Presupuesto de Ahora 
      Madrid y los ingresos que llevamos hasta el momento.
      </p>
      
      <p>Nuestra intención es publicar al detalle de cada gasto pasada la campaña y una vez contrastadas las facturas que estamos recibiendo. Igual con los 
      ingresos, ya que debemos verificar los datos de las donaciones y 
      micro-créditos.</p>
    
    </div>
    
    <div class="col-md-5 text-right nopaddingR">
      <p>&nbsp;</p>
      <hr/>
      <select>
        <option value="volvo">Gastos Campaña Elecciones Municipales 2015</option>
        <option value="saab">Ingresos Campaña Elecciones Municipales 2015</option>
        <option value="mercedes">Gastos Ejercicio 2015</option>
        <option value="audi">Ingresos Ejercicio 2015</option>
      </select>
      
      <hr/>
      
      <p><em>última actualización: 20 de mayo, 2015</em></p>
      <p><a href="datos_03/gastos.csv"><i class="fa fa-download" style="padding-right: 1em;"></i> <small>descargar .csv</small></a></p>
      </div>
    </div>
    
    <div class="row">
      <div class="col-md-12 noPadding">
        <hr/>
        <h2>ingresos por salarios</h2>
        <p>Lectores legere me lius quod ii legunt saepius claritas est etiam processus dynamicus qui. Facer possim assum, typi non habent claritatem insitam est usus legentis in iis qui facit eorum. Demonstraverunt sequitur mutationem consuetudium lectorum mirum est notare quam.
        </p>
      </div>
    </div>
    
    
     
     <div class="col-md-12 noPadding">
      <hr/>
     
      <h4>eventuales</h4>
      <p>Placerat facer possim assum typi non habent claritatem insitam est usus legentis in iis qui facit. Amet consectetuer adipiscing elit sed diam nonummy nibh euismod tincidunt ut. 
      </p>
      <ul class="nav nav-tabs">
          <li role="presentation" class="active">
            <a href="#periodo-0"> 15 Junio 2015 - 30 Dic 2015</a>
          </li>          
        </ul>
        <div id="my-tab-content" class="tab-content">
            <div class="tab-pane active" id="periodo-0">
              <table id="salarios_eventuales" class="table tablesorter"> 
                  <thead> 
                  <tr> 
                      <th>nombre</th> 
                      <th>apellidos</th>
                      <th>categoría</th>
                      <th>Organismo</th>
                      <th>sueldo limitado neto</th> 
                      <th>sueldo neto al mes</th> 
                      <th>goteo</th>
                      <th>donaciones</th>
                   </tr> 
                   
                  </thead> 
                  <tbody></tbody> 
                  </table>
            </div>
        </div>



      
      
      
         </div>
     
    </div>
    
    <footer>
    <div class="row">
    <div class="col-md-12 noPadding">
    footer
    </div>
    </div>
    
    </footer>
    
    
    </div> <!-- end container -->
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
     <script src="js/jquery.min.js"></script>
     <!-- Include all compiled plugins (below), or include individual files as needed -->
     <script src="js/bootstrap.min.js"></script>
     
     <!-- CSV parse -->
     <script src="js/papaparse.min.js"></script>
     <!-- formatCurrency -->
     <script src="js/jquery.formatCurrency-1.4.0.pack.js"></script>
      <!-- formatDate -->
      <script src="js/moment-with-locales.js"></script>
     
     <!-- tablesorter -->
     <script type="text/javascript" src="js/jquery.tablesorter.min.js"></script> 
     
     <!-- highcharts.js -->
     <script src="https://code.highcharts.com/highcharts.js"></script>
     <script type="text/javascript" src="https://code.highcharts.com/modules/data.js"></script>
     
     <!-- isotope -->
     <script src="js/isotope.pkgd.js"></script>
     <script src="js/packery-mode.pkgd.min.js"></script>
     
      <!-- cookies -->
     <script src="js/js.cookie.js"></script>
     
     
     <script>
     
      
     var totC = {nominal:0.0, percibido:0.0, goteo:0.0, donacion:0.0, c:0.0, e:0.0};
     moment.locale('es');  // translate dates to es format
     
    
    var meses = []; // todos MM_AAAA
    var mesesR = []; // rótulos MM, AAAA
    var mesesL = []; // labels
    
    var peopleID = []; // just ID // once
    var peopleIDRow = []; // just ID
    var peopleData = []; // data Objects // once
    var peopleDataRow = {}; // data Objects

     
     $(document).ready(function() { 
          Papa.parse("datos_03/eventuales.tsv", {
        download: true,
        header: true,
        delimiter: "\t",    
        complete: function(results) {
             //console.log(results.data);         
            
            resultados=results
            $.each( results.data, function( index, value ) {

                 var obj = value;

                 if(  ("Apellidos" in obj) == false  || ("Nombre" in obj)== false) return true;
                console.log(obj)
                 var miMes = moment(obj.fecha, "DD/MM/YYYY").format("MMMM");
                 var miAnno = moment(obj.fecha, "DD/MM/YYYY").format("YYYY");
                 var mes_anno = miMes +"_" + miAnno;
                 var mesYanno = miMes +", " + miAnno;
                 meses.push(mes_anno);
                 mesesR.push(mesYanno);
                 //console.log(miFecha);
                 peopleIDRow.push(obj.id); 
                 // people data
                 // create new object > add to array
                 peopleDataRow[obj.id] = {
                  nombre: obj.Nombre, 
                  apellidos: obj.Apellidos, 
                  categoria: obj.Categoria,
                  organismo : obj.Organismo,
                  status: 'e', nominal: 0.0, percibido: 0.0, goteo: 0.0, donaciones: 0.0};
            }); 
            
            //console.log(peopleID);
            // unique ID
            
            // var uniqueNames = [];
            $.each(peopleIDRow, function(i, el){
                if($.inArray(el, peopleID) === -1){
                 peopleID.push(el);
                }
            });
            
            for (i = 0; i < peopleID.length; i++) { 
                //console.log(peopleID[i]);
                var ID = peopleID[i];
                var P = peopleDataRow[ID];
                peopleData[ID] = P;
                console.log(peopleData[ID])
            }
            
            //console.log(peopleData);
                        
            //peopleIDRow = []; // clean up
            //peopleDataRow = [];
                    
            // unique month
            var thisM = meses[0];
            mesesL.push(thisM);
            
            var mesesTot = {};
            //mesesTot[thisM] = 0.0;
            
            mesesTot[thisM] = {nominal: 0.0, percibido: 0.0, goteo: 0.0, donaciones: 0.0};
    
            var mesesRot = []; 
            mesesRot.push(mesesR[0]);
            
            for (i = 0; i < meses.length -1; i++) { 
                var nextM = meses[i+1];
                
                if(thisM == nextM){
                // nothing
                } else {
                    thisM = nextM;
                    mesesL.push(thisM);
                    mesesTot[thisM] = {nominal: 0.0, percibido: 0.0, goteo: 0.0, donaciones: 0.0};
                    mesesRot.push(mesesR[i+1]);
                }
            }
            
            
        $.each( results.data, function( index, value ) {
             var obj = value;
             if(  ("Apellidos" in obj) == false  || ("Nombre" in obj)== false) return true;
             // tot by month
             var miMMMM = moment(obj.fecha, "DD/MM/YYYY").format("MMMM");
             var miAAAA = moment(obj.fecha, "DD/MM/YYYY").format("YYYY");
             var miMM_AAAA = miMMMM + "_" + miAAAA;
             
             // tot by people
             peopleData[obj.id].nominal += parseFloat(obj.s_nominal);
             peopleData[obj.id].percibido += parseFloat(obj.s_percibido);
             peopleData[obj.id].goteo += parseFloat(obj.goteo);
             peopleData[obj.id].donaciones += parseFloat(obj.donacion_1);
             peopleData[obj.id].donaciones += parseFloat(obj.donacion_2);
              
             mesesTot[miMM_AAAA].nominal += parseFloat(obj.s_nominal);
             mesesTot[miMM_AAAA].percibido += parseFloat(obj.s_percibido);
             mesesTot[miMM_AAAA].goteo += parseFloat(obj.goteo);
             mesesTot[miMM_AAAA].donaciones += parseFloat(obj.donacion_1);
             mesesTot[miMM_AAAA].donaciones += parseFloat(obj.donacion_2);
              
             // totals
            // console.log(obj)
             totC['nominal'] += parseFloat(obj.s_nominal);
             totC['percibido'] += parseFloat(obj.s_percibido);
             totC['goteo'] += parseFloat(obj.goteo);
             totC['donacion'] += parseFloat(obj.donacion_1);
             totC['donacion'] += parseFloat(obj.donacion_2);
              
             totC[obj.status] += parseFloat(obj.s_percibido);
                
        }); 
        
        // table > monts
        var myTable =  $("#salarios_meses > tbody");
        for (i = 0; i < mesesL.length; i++) { 
            var thisM = mesesL[i];
            
            var myRow = "<tr>";
            myRow += "<td>" + mesesRot[i] + "</td>" ; // mes, año
            myRow += "<td class='money'>" + mesesTot[thisM].nominal + "</td>" ;
            myRow += "<td class='money'>" + mesesTot[thisM].percibido + "</td>" ;
            myRow += "<td class='money'>" + mesesTot[thisM].goteo + "</td>" ;
            myRow += "<td class='money'>" + mesesTot[thisM].donaciones + "</td>" ;
                        
            $(myTable).append( myRow);
        }
        
    
        
        
        // 
        var myTable =  $("#salarios_eventuales > tbody");             
        for (i = 0; i < peopleID.length; i++) {         
            var miID = peopleID[i];
            var obj = peopleData[miID];
            // console.log(obj.nombre);
            
            if(obj.status === "c"){                
              continue;
              } else {
              // eventual
                  var myRow = "<tr>";
                  myRow += "<td>" + obj.nombre + "</td>" ; 
                  myRow += "<td>" + obj.apellidos + "</td>" ; 
                  myRow += "<td>" + obj.categoria + "</td>" ; 
                  myRow += "<td>" + obj.organismo + "</td>" ;
                  myRow += "<td class='money'>" + obj.nominal + "</td>" ;
                  myRow += "<td class='money'>" + obj.percibido + "</td>" ;
                  myRow += "<td class='money'>" + obj.goteo + "</td>" ;
                  myRow += "<td class='money'>" + obj.donaciones + "</td>" ;                                    
                  $(myTable).append( myRow);
                //  console.log("append eventual");                        
              }
            //console.log("fin append concejal" + obj.nombre);
        
        }
        window.setTimeout(initC, 200); //ñaaaapa. Si no hay un poco de retraso a veces no ejecuta la funcion de cards
        } // end complete loading json
        
     }); // end pepa parse
console.log("fin document ready");
    }); //end document ready 
     
     
     
    var initC=function() {
     console.log("init");
    
    $('.money').formatCurrency({
            decimalSymbol: ',',
            digitGroupSymbol: '.',
            symbol: '€',
            positiveFormat: '%n <span class="euro">%s</span>',
    });
         
    $("#salarios_meses").tablesorter({ 
             // sort on the first column and third column, order asc 
              sortList: [[0,0]] 
         }); 
     
     $("#salarios_eventuales").tablesorter({ 
             // sort on the first column and third column, order asc 
              // sortList: [[0,0]] 
        });     
      
      // isotope
      console.log($(''))
      var $grid = $('#concejales').isotope({
        // options
        itemSelector: '.card',
        // layoutMode: 'fitRows',
        layoutMode: 'packery',
        packery: {
          gutter: 8
        }         
      });
      
      $( ".card" ).click(function() {
        var c = $(this ).data( "id" ); // 52
        Cookies.set('concejal', c, { expires: 7, path: '' });
        window.location.href = "concejal.html";
        // alert( "Handler for " + c);
      }); 
      
      
           
    }     
     
     
               
    </script>
</body>

</html>
